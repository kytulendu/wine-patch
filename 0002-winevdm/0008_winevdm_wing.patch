From 8efacfc378ce5e65ca8d01d016f690d63f706448 Mon Sep 17 00:00:00 2001
From: Khral Steelforge <garuda2550@gmail.com>
Date: Tue, 19 Feb 2019 01:34:03 +0700
Subject: wing.dll16: Port the patch from winevdm.
from https://github.com/otya128/winevdm/tree/v0.7.0/wing

Signed-off-by: Khral Steelforge <garuda2550@gmail.com>

diff --git a/dlls/wing.dll16/wing.c b/dlls/wing.dll16/wing.c
index e1f2c07095..a2f4821cc4 100644
--- a/dlls/wing.dll16/wing.c
+++ b/dlls/wing.dll16/wing.c
@@ -242,6 +242,78 @@ UINT16 WINAPI WinGGetDIBColorTable16(HDC16 hdc, UINT16 start, UINT16 num, RGBQUA
     return GetDIBColorTable( HDC_32(hdc), start, num, colors );
 }
 
+typedef struct {
+    WORD         palVersion;
+    WORD         palNumEntries;
+    PALETTEENTRY palPalEntry[256];
+} logpalette_8bpp;
+
+static const logpalette_8bpp wing_halftone_pal = {0x300, 0x100,
+{{0x00,0x00,0x00,0x04}, {0x80,0x00,0x00,0x04}, {0x00,0x80,0x00,0x04}, {0x80,0x80,0x00,0x04},
+{0x00,0x00,0x80,0x04}, {0x80,0x00,0x80,0x04}, {0x00,0x80,0x80,0x04}, {0xC0,0xC0,0xC0,0x04},
+{0xC0,0xDC,0xC0,0x04}, {0xA6,0xCA,0xF0,0x04}, {0x04,0x04,0x04,0x04}, {0x08,0x08,0x08,0x04},
+{0x0C,0x0C,0x0C,0x04}, {0x11,0x11,0x11,0x04}, {0x16,0x16,0x16,0x04}, {0x1C,0x1C,0x1C,0x04},
+{0x22,0x22,0x22,0x04}, {0x29,0x29,0x29,0x04}, {0x55,0x55,0x55,0x04}, {0x4D,0x4D,0x4D,0x04},
+{0x42,0x42,0x42,0x04}, {0x39,0x39,0x39,0x04}, {0x81,0x81,0x81,0x04}, {0x81,0x00,0x00,0x04},
+{0x00,0x81,0x00,0x04}, {0x81,0x81,0x00,0x04}, {0x00,0x00,0x81,0x04}, {0x81,0x00,0x81,0x04},
+{0x00,0x81,0x81,0x04}, {0x33,0x00,0x00,0x04}, {0x66,0x00,0x00,0x04}, {0x99,0x00,0x00,0x04},
+{0xCC,0x00,0x00,0x04}, {0x00,0x33,0x00,0x04}, {0x33,0x33,0x00,0x04}, {0x66,0x33,0x00,0x04},
+{0x99,0x33,0x00,0x04}, {0xCC,0x33,0x00,0x04}, {0xFF,0x33,0x00,0x04}, {0x00,0x66,0x00,0x04},
+{0x33,0x66,0x00,0x04}, {0x66,0x66,0x00,0x04}, {0x99,0x66,0x00,0x04}, {0xCC,0x66,0x00,0x04},
+{0xFF,0x66,0x00,0x04}, {0x00,0x99,0x00,0x04}, {0x33,0x99,0x00,0x04}, {0x66,0x99,0x00,0x04},
+{0x99,0x99,0x00,0x04}, {0xCC,0x99,0x00,0x04}, {0xFF,0x99,0x00,0x04}, {0x00,0xCC,0x00,0x04},
+{0x33,0xCC,0x00,0x04}, {0x66,0xCC,0x00,0x04}, {0x99,0xCC,0x00,0x04}, {0xCC,0xCC,0x00,0x04},
+{0xFF,0xCC,0x00,0x04}, {0x66,0xFF,0x00,0x04}, {0x99,0xFF,0x00,0x04}, {0xCC,0xFF,0x00,0x04},
+{0x00,0x00,0x33,0x04}, {0x33,0x00,0x33,0x04}, {0x66,0x00,0x33,0x04}, {0x99,0x00,0x33,0x04},
+{0xCC,0x00,0x33,0x04}, {0xFF,0x00,0x33,0x04}, {0x00,0x33,0x33,0x04}, {0x33,0x33,0x33,0x04},
+{0x66,0x33,0x33,0x04}, {0x99,0x33,0x33,0x04}, {0xCC,0x33,0x33,0x04}, {0xFF,0x33,0x33,0x04},
+{0x00,0x66,0x33,0x04}, {0x33,0x66,0x33,0x04}, {0x66,0x66,0x33,0x04}, {0x99,0x66,0x33,0x04},
+{0xCC,0x66,0x33,0x04}, {0xFF,0x66,0x33,0x04}, {0x00,0x99,0x33,0x04}, {0x33,0x99,0x33,0x04},
+{0x66,0x99,0x33,0x04}, {0x99,0x99,0x33,0x04}, {0xCC,0x99,0x33,0x04}, {0xFF,0x99,0x33,0x04},
+{0x00,0xCC,0x33,0x04}, {0x33,0xCC,0x33,0x04}, {0x66,0xCC,0x33,0x04}, {0x99,0xCC,0x33,0x04},
+{0xCC,0xCC,0x33,0x04}, {0xFF,0xCC,0x33,0x04}, {0x33,0xFF,0x33,0x04}, {0x66,0xFF,0x33,0x04},
+{0x99,0xFF,0x33,0x04}, {0xCC,0xFF,0x33,0x04}, {0xFF,0xFF,0x33,0x04}, {0x00,0x00,0x66,0x04},
+{0x33,0x00,0x66,0x04}, {0x66,0x00,0x66,0x04}, {0x99,0x00,0x66,0x04}, {0xCC,0x00,0x66,0x04},
+{0xFF,0x00,0x66,0x04}, {0x00,0x33,0x66,0x04}, {0x33,0x33,0x66,0x04}, {0x66,0x33,0x66,0x04},
+{0x99,0x33,0x66,0x04}, {0xCC,0x33,0x66,0x04}, {0xFF,0x33,0x66,0x04}, {0x00,0x66,0x66,0x04},
+{0x33,0x66,0x66,0x04}, {0x66,0x66,0x66,0x04}, {0x99,0x66,0x66,0x04}, {0xCC,0x66,0x66,0x04},
+{0x00,0x99,0x66,0x04}, {0x33,0x99,0x66,0x04}, {0x66,0x99,0x66,0x04}, {0x99,0x99,0x66,0x04},
+{0xCC,0x99,0x66,0x04}, {0xFF,0x99,0x66,0x04}, {0x00,0xCC,0x66,0x04}, {0x33,0xCC,0x66,0x04},
+{0x99,0xCC,0x66,0x04}, {0xCC,0xCC,0x66,0x04}, {0xFF,0xCC,0x66,0x04}, {0x00,0xFF,0x66,0x04},
+{0x33,0xFF,0x66,0x04}, {0x99,0xFF,0x66,0x04}, {0xCC,0xFF,0x66,0x04}, {0xFF,0x00,0xCC,0x04},
+{0xCC,0x00,0xFF,0x04}, {0x00,0x99,0x99,0x04}, {0x99,0x33,0x99,0x04}, {0x99,0x00,0x99,0x04},
+{0xCC,0x00,0x99,0x04}, {0x00,0x00,0x99,0x04}, {0x33,0x33,0x99,0x04}, {0x66,0x00,0x99,0x04},
+{0xCC,0x33,0x99,0x04}, {0xFF,0x00,0x99,0x04}, {0x00,0x66,0x99,0x04}, {0x33,0x66,0x99,0x04},
+{0x66,0x33,0x99,0x04}, {0x99,0x66,0x99,0x04}, {0xCC,0x66,0x99,0x04}, {0xFF,0x33,0x99,0x04},
+{0x33,0x99,0x99,0x04}, {0x66,0x99,0x99,0x04}, {0x99,0x99,0x99,0x04}, {0xCC,0x99,0x99,0x04},
+{0xFF,0x99,0x99,0x04}, {0x00,0xCC,0x99,0x04}, {0x33,0xCC,0x99,0x04}, {0x66,0xCC,0x66,0x04},
+{0x99,0xCC,0x99,0x04}, {0xCC,0xCC,0x99,0x04}, {0xFF,0xCC,0x99,0x04}, {0x00,0xFF,0x99,0x04},
+{0x33,0xFF,0x99,0x04}, {0x66,0xCC,0x99,0x04}, {0x99,0xFF,0x99,0x04}, {0xCC,0xFF,0x99,0x04},
+{0xFF,0xFF,0x99,0x04}, {0x00,0x00,0xCC,0x04}, {0x33,0x00,0x99,0x04}, {0x66,0x00,0xCC,0x04},
+{0x99,0x00,0xCC,0x04}, {0xCC,0x00,0xCC,0x04}, {0x00,0x33,0x99,0x04}, {0x33,0x33,0xCC,0x04},
+{0x66,0x33,0xCC,0x04}, {0x99,0x33,0xCC,0x04}, {0xCC,0x33,0xCC,0x04}, {0xFF,0x33,0xCC,0x04},
+{0x00,0x66,0xCC,0x04}, {0x33,0x66,0xCC,0x04}, {0x66,0x66,0x99,0x04}, {0x99,0x66,0xCC,0x04},
+{0xCC,0x66,0xCC,0x04}, {0xFF,0x66,0x99,0x04}, {0x00,0x99,0xCC,0x04}, {0x33,0x99,0xCC,0x04},
+{0x66,0x99,0xCC,0x04}, {0x99,0x99,0xCC,0x04}, {0xCC,0x99,0xCC,0x04}, {0xFF,0x99,0xCC,0x04},
+{0x00,0xCC,0xCC,0x04}, {0x33,0xCC,0xCC,0x04}, {0x66,0xCC,0xCC,0x04}, {0x99,0xCC,0xCC,0x04},
+{0xCC,0xCC,0xCC,0x04}, {0xFF,0xCC,0xCC,0x04}, {0x00,0xFF,0xCC,0x04}, {0x33,0xFF,0xCC,0x04},
+{0x66,0xFF,0x99,0x04}, {0x99,0xFF,0xCC,0x04}, {0xCC,0xFF,0xCC,0x04}, {0xFF,0xFF,0xCC,0x04},
+{0x33,0x00,0xCC,0x04}, {0x66,0x00,0xFF,0x04}, {0x99,0x00,0xFF,0x04}, {0x00,0x33,0xCC,0x04},
+{0x33,0x33,0xFF,0x04}, {0x66,0x33,0xFF,0x04}, {0x99,0x33,0xFF,0x04}, {0xCC,0x33,0xFF,0x04},
+{0xFF,0x33,0xFF,0x04}, {0x00,0x66,0xFF,0x04}, {0x33,0x66,0xFF,0x04}, {0x66,0x66,0xCC,0x04},
+{0x99,0x66,0xFF,0x04}, {0xCC,0x66,0xFF,0x04}, {0xFF,0x66,0xCC,0x04}, {0x00,0x99,0xFF,0x04},
+{0x33,0x99,0xFF,0x04}, {0x66,0x99,0xFF,0x04}, {0x99,0x99,0xFF,0x04}, {0xCC,0x99,0xFF,0x04},
+{0xFF,0x99,0xFF,0x04}, {0x00,0xCC,0xFF,0x04}, {0x33,0xCC,0xFF,0x04}, {0x66,0xCC,0xFF,0x04},
+{0x99,0xCC,0xFF,0x04}, {0xCC,0xCC,0xFF,0x04}, {0xFF,0xCC,0xFF,0x04}, {0x33,0xFF,0xFF,0x04},
+{0x66,0xFF,0xCC,0x04}, {0x99,0xFF,0xFF,0x04}, {0xCC,0xFF,0xFF,0x04}, {0xFF,0x66,0x66,0x04},
+{0x66,0xFF,0x66,0x04}, {0xFF,0xFF,0x66,0x04}, {0x66,0x66,0xFF,0x04}, {0xFF,0x66,0xFF,0x04},
+{0x66,0xFF,0xFF,0x04}, {0xC1,0xC1,0xC1,0x04}, {0x5F,0x5F,0x5F,0x04}, {0x77,0x77,0x77,0x04},
+{0x86,0x86,0x86,0x04}, {0x96,0x96,0x96,0x04}, {0xCB,0xCB,0xCB,0x04}, {0xB2,0xB2,0xB2,0x04},
+{0xD7,0xD7,0xD7,0x04}, {0xDD,0xDD,0xDD,0x04}, {0xE3,0xE3,0xE3,0x04}, {0xEA,0xEA,0xEA,0x04},
+{0xF1,0xF1,0xF1,0x04}, {0xF8,0xF8,0xF8,0x04}, {0xFF,0xFB,0xF0,0x04}, {0xA0,0xA0,0xA4,0x04},
+{0x80,0x80,0x80,0x04}, {0xFF,0x00,0x00,0x04}, {0x00,0xFF,0x00,0x04}, {0xFF,0xFF,0x00,0x04},
+{0x00,0x00,0xFF,0x04}, {0xFF,0x00,0xFF,0x04}, {0x00,0xFF,0xFF,0x04}, {0xFF,0xFF,0xFF,0x04}}};
+
 /***********************************************************************
  *  WinGCreateHalfTonePalette   (WING.1007)
  *
@@ -256,10 +328,8 @@ UINT16 WINAPI WinGGetDIBColorTable16(HDC16 hdc, UINT16 start, UINT16 num, RGBQUA
  */
 HPALETTE16 WINAPI WinGCreateHalfTonePalette16(void)
 {
-    HDC hdc = CreateCompatibleDC(0);
-    HPALETTE16 ret = HPALETTE_16( CreateHalftonePalette( hdc ));
+    HPALETTE16 ret = HPALETTE_16( CreatePalette( (const LOGPALETTE *)&wing_halftone_pal ));
     TRACE("(void)\n");
-    DeleteDC( hdc );
     return ret;
 }
 
